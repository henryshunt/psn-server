<meta charset="UTF-8">
<!DOCTYPE html>

<html>
    <head>
        <title>Project - Phenotyping Sensor Network</title>
        <meta name="viewport" content="width=450px">

        <link href="{{ assets }}/css/reset.css" rel="stylesheet">
        <link href="{{ assets }}/css/globals.css" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Istok+Web:400,400i,700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons&display=block" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.27/moment-timezone-with-data-10-year-range.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/flatpickr@4.6.3/dist/flatpickr.min.css" rel="stylesheet" type="text/css">
        <script src="https://cdn.jsdelivr.net/npm/flatpickr@4.6.3/dist/flatpickr.min.js" type="text/javascript"></script>
        <script src="{{ assets }}/js/helpers.js"></script>

        <link href="{{ assets }}/css/header.css" rel="stylesheet">
        <script src="{{ assets }}/js/header.js"></script>
        <link href="{{ assets }}/css/grouping.css" rel="stylesheet">
        <link href="{{ assets }}/css/modal.css" rel="stylesheet">
        <link href="{{ assets }}/css/pages/project.css" rel="stylesheet">
        <script src="{{ assets }}/js/pages/project.js"></script>

        <script>
            const projectName = "{{ project.name }}";
            const projectDescription = "{{ project.description }}";
        </script>
    </head>

    <body>
        {% include "partials/header.twig" with { "loggedIn": true } %}

        <main id="main">
            <div class="info-group" id="project-info-group">
                <div class="info-group__left">
                    <p class="info-group__header">
                        <span class="info-group__title">Project View: </span>
                        <span class="info-group__sub-title" id="project-name">{{ project.name }}</span>
                    </p>

                    <p class="info-group__body" id="project-desc">
                        {% if project.description is null %}
                            {{ "<i>No Description Available</i>" }}
                        {% else %}
                            {{ project.description }}
                        {% endif %}
                    </p>
                </div>
            
                <div class="info-group__right">
                    <button class="info-group__action" id="edit-project-btn">Edit Project</button>
                    <button class="info-group__action" id="download-data-btn">Download All Data</button>

                    {% if project.isActive %}
                        <button class="info-group__action" id="stop-project-btn">Stop Project</button>
                    {% endif %}

                    <button class="info-group__action info-group__action--last" id="delete-project-btn">Delete Project</button>
                </div>
            </div>

            <div class="titled-group" id="active-nodes-group">
                <div class="titled-group__header">
                    <h2 class="titled-group__title">Active Sensor Nodes</h2>
                    <button class="titled-group__action" id="add-node-btn">Add Node</button>
                    <div class="titled-group__separator"></div>
                </div>

                <div class="items-block" id="active-nodes">
                    {% for node in activeNodes %}
                        <div class="items-block__item">
                            <a class="item__anchor"
                                href="{{ url_for("node", {"projectId": project.projectId, "nodeId": node.nodeId }) }}">

                                <p class="item__title">{{ node.location }}</p>
                                <p class="item__sub-title">{{ node.reportTime }}</p>

                                {% if node.latestReport != null %}
                                    <div class="item__corner item__corner--node">
                                        <div><p>Temp.</p><p>{{ node.latestReport.airt }}</p></div>
                                        <div><p>Humid.</p><p>{{ node.latestReport.relh }}</p></div>
                                    </div>
                                {% endif %}
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="titled-group" id="completed-nodes-group">
                <div class="titled-group__header">
                    <h2 class="titled-group__title">Completed Sensor Nodes</h2>
                    <div class="titled-group__separator"></div>
                </div>

                <div class="items-block" id="completed-nodes">
                    {% for node in inactiveNodes %}
                        <div class="items-block__item items-block__item--thin">
                            <a class="item__anchor"
                                href="{{ url_for("node", {"projectId": project.projectId, "nodeId": node.nodeId }) }}">
                                
                                <p class="item__title">{{ node.location }}</p>
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </main>


        <div class="modal__shade modal__shade--hidden" id="modal-shade"></div>

        <!-- Edit project modal -->
        <div class="modal modal--hidden" id="editprj-modal">
            <div class="modal__header">
                <p class="modal__title">Edit Project Information</p>
            </div>

            <div class="modal__content">
                <form id="m-editprj-form">
                    <p class="modal__field-title">Name</p>
                    <input class="m-editprj-name" id="m-editprj-name" type="text" maxlength="128"/>

                    <p class="modal__field-title">Description</p>
                    <textarea class="m-editprj-desc" id="m-editprj-desc" maxlength="255"></textarea>
                </form>
            </div>

            <div class="modal__footer">
                <p class="modal__status" id="m-editprj-status"></p>

                <div class="modal__buttons">
                    <button class="modal__submit" id="m-editprj-submit" form="m-editprj-form">Save</button>
                    <button class="modal__cancel" id="m-editprj-cancel">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Add node modal -->
        <div class="modal modal--hidden" id="addnode-modal">
            <div class="modal__header">
                <p class="modal__title">Add a Sensor Node to the Project</p>
            </div>

            <div class="modal__content">
                <form id="m-addnode-form">
                    <p class="modal__field-title">Sensor Node</p>
                    <select class="m-addnode-node" id="m-addnode-node">
                        <option>Select</option>
                    </select>

                    <p class="modal__field-title">Description of Location</p>
                    <input class="m-addnode-location" id="m-addnode-location" type="text" maxlength="128"/>

                    <p class="modal__field-title">Reporting Interval</p>
                    <select class="m-addnode-interval" id="m-addnode-interval">
                        <option value="1">1 Minute</option>
                        <option value="2">2 Minutes</option>
                        <option value="5">5 Minutes</option>
                        <option value="10">10 Minutes</option>
                        <option value="15">15 Minutes</option>
                        <option value="20">20 Minutes</option>
                        <option value="30">30 Minutes</option>
                    </select>

                    <p class="modal__field-title">End Reporting At (Leave Empty for No End)</p>
                    <input class="m-addnode-end" id="m-addnode-end" type="text"/>

                    <p class="modal__field-title">Transmit Reports in Batches Of</p>
                    <input class="m-addnode-batch" id="m-addnode-batch" type="number" min="1" max="127" value="1"/>
                </form>
            </div>

            <div class="modal__footer">
                <p class="modal__status" id="m-addnode-status"></p>

                <div class="modal__buttons">
                    <button class="modal__submit" id="m-addnode-submit" form="m-addnode-form" disabled>Add</button>
                    <button class="modal__cancel" id="m-addnode-cancel" disabled>Cancel</button>
                </div>
            </div>
        </div>
    </body>
</html>